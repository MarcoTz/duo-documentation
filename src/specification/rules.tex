\documentclass[11pt]{article}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{stmaryrd}
\usepackage{mathtools}
\usepackage{xcolor}
\usepackage{csquotes}

\newcommand{\translate}[1]{\llbracket #1 \rrbracket}
\newcommand{\C}{\mathcal{C}}

\newcommand{\case}[1]{\mathbf{case}\ \{\ #1\ \}}
\newcommand{\caseof}[2]{\mathbf{case}\ #1\ \mathbf{of}\ \{\ #2\ \}}

\newcommand{\pat}[1]{\C\Gamma \Rightarrow #1 }
\newcommand{\prdpat}[2]{\C\Gamma(#1)\Delta \Rightarrow #2 }
\newcommand{\cnspat}[2]{\C\Gamma[#1]\Delta \Rightarrow #2 }

\newcommand{\nonterminal}[1]{\langle #1 \rangle}
\newcommand{\terminal}[1]{\colorbox{lightgray}{\vphantom{X}#1}}
\newcommand{\cut}[2]{\langle\ #1\ |\ #2\ \rangle}

\begin{document}

\section{Duo Reference}

\subsection{Duo Syntax}
This section describes the syntax as it is implemented in the parser.
Only a subset of this syntax is a valid Duo program.

\subsubsection{Variables and Identifiers}
\[
  \begin{array}{lclr}
    \nonterminal{var} & \Coloneqq & [a..z][a..zA..Z0..9] & \emph{Variables} \\
    \nonterminal{tyvar} & \Coloneqq & [a..z][a..zA..Z0..9] & \emph{Type Variables} \\
    \nonterminal{tyname} & \Coloneqq & [A..Z][a..zA..Z0..9] & \emph{Type Names} \\
    \nonterminal{xtorname} & \Coloneqq & [A..Z][a..zA..Z0..9] & \emph{Xtor Names} \\
  \end{array}
\]

\subsubsection{Primitive Literals}
\[
  \begin{array}{lclr}
    \nonterminal{intlit} & \Coloneqq & \ldots & \emph{Integer Literal} \\
    \nonterminal{floatlit} & \Coloneqq & \ldots & \emph{Float Literal} \\
    \nonterminal{charlit} & \Coloneqq & \ldots & \emph{Char Literal} \\
    \nonterminal{stringlit} & \Coloneqq & \ldots & \emph{String Literal} \\
  \end{array}
\]

\subsubsection{Patterns}
\[
  \begin{array}{lclr}
    \nonterminal{pat} & \Coloneqq & \nonterminal{var} & \emph{Variable Pattern} \\
    & | & \terminal{\_} & \emph{Wildcard Pattern} \\
    & | & \nonterminal{xtorname}\terminal{(}\nonterminal{pat}^{\ast} \terminal{)} & \emph{Xtor Pattern}\\
    & | & \terminal{$\ast$} & \emph{Star Pattern} \\
  \end{array}
\]

\subsubsection{Terms and Commands}
\[
  \begin{array}{lclr}
    \nonterminal{tm} & \Coloneqq & \nonterminal{var} & \emph{Variable} \\
    & | & \terminal{mu}\ \nonterminal{var} \terminal{.} \nonterminal{tm} & \textit{Mu Abstraction} \\
    & | & \nonterminal{tm} \terminal{$\gg$} \nonterminal{tm} & \textit{Apply} \\
    & | & \nonterminal{xtorname}\nonterminal{subst} & \emph{Xtor} \\
    & | & \terminal{case}\ \terminal{\{} (\nonterminal{pat} \terminal{$\Rightarrow$} \nonterminal{tm})^{\ast} \terminal{\}} & \emph{Case} \\
    & | & \terminal{case}\ \nonterminal{tm}\ \terminal{of}\ \terminal{\{} (\nonterminal{pat} \terminal{$\Rightarrow$} \nonterminal{tm})^{\ast} \terminal{\}} & \emph{CaseOf} \\
    & | & \terminal{cocase}\ \terminal{\{} (\nonterminal{pat} \terminal{$\Rightarrow$} \nonterminal{tm})^{\ast} \terminal{\}} & \emph{Cocase} \\
    & | & \terminal{cocase}\ \nonterminal{tm}\ \terminal{of}\ \terminal{\{} (\nonterminal{pat} \terminal{$\Rightarrow$} \nonterminal{tm})^{\ast} \terminal{\}} & \emph{CocaseOf} \\
    & | & \nonterminal{xtorname}\nonterminal{starsubst}\terminal{;;}\nonterminal{tm} & \emph{Semi} \\
    & | & \nonterminal{tm}\terminal{.}\nonterminal{xtorname}\nonterminal{starsubst} & \emph{Dtor} \\
    & | & \terminal{$\backslash$} \nonterminal{var}^{\ast}\terminal{$\Rightarrow$} \nonterminal{tm} & \emph{MultiLambda} \\
    & | & \nonterminal{tm} \nonterminal{tm} & \emph{FunApp} \\
    & | & \nonterminal{floatlit}\terminal{$\#F64$} & \emph{PrimLitF64} \\
    & | & \nonterminal{intlit}\terminal{$\#I64$} & \emph{PrimLitI64} \\
    & | & \nonterminal{stringlit} & \emph{Primitive String} \\
    & | & \nonterminal{charlit} & \emph{Primitive Char} \\
    \nonterminal{subst} & \Coloneqq & \terminal{(} \nonterminal{tm}^{\ast} \terminal{)} & \emph{Substitution} \\
    \nonterminal{starsubst} & \Coloneqq & \terminal{(} \nonterminal{tm}^{\ast} \terminal{*} \nonterminal{tm}^{\ast} \terminal{)} & \emph{Star Substitution} \\ 
  \end{array}
\]


\section{Duo Semantics}

\begin{align*}
  \translate{\C\sigma} \coloneqq \C\translate{\sigma}
\end{align*}

\begin{align*}
  \translate{\caseof{prd}{\pat{prd'}}} &\coloneqq \mu k.\cut{\translate{prd}}{\case{\pat{\cut{\translate{prd'}}{k}}}}\\
  \translate{\caseof{prd}{\pat{cns}}} &\coloneqq \mu x.\cut{\translate{prd}}{\case{\pat{\cut{x}{\translate{cns}}}}}\\
  \translate{\caseof{prd}{\pat{cmd}}} &\coloneqq \cut{\translate{prd}}{\case{\pat{\translate{cmd}}}}\\
  \translate{\caseof{prd}{\prdpat{*}{cns}}} &\coloneqq \cut{\translate{prd}}{\case{\prdpat{x}{\cut{x}{\translate{cns}}}}} \\
  \translate{\caseof{prd}{\cnspat{*}{prd'}}} &\coloneqq \cut{\translate{prd}}{\case{\cnspat{k}{\cut{\translate{prd'}}{k}}}} \\
\end{align*}

\begin{align*}
  \translate{\case{\pat{cmd}}} &\coloneqq \case{\pat{\translate{cmd}}} \\
  \translate{\case{\prdpat{*}{cns}}} &\coloneqq \case{\prdpat{x}{\cut{x}{\translate{cns}}}} \\
  \translate{\case{\cnspat{*}{prd}}} &\coloneqq \case{\cnspat{k}{\cut{\translate{prd}}{k}}} \\
\end{align*}

\begin{align*}
  \translate{\C\sigma;cns} &\coloneqq \cut{\C\translate{\sigma}}{\translate{cns}} \\
  \translate{\C\sigma(*)\tau;cns} &\coloneqq \mu x.\cut{\C\translate{\sigma}(x)\translate{\tau}}{\translate{cns}} \\
  \translate{\C\sigma[*]\tau;cns} &\coloneqq \mu k.\cut{\C\translate{\sigma}[k]\translate{\tau}}{\translate{cns}} \\
\end{align*}

\end{document}
